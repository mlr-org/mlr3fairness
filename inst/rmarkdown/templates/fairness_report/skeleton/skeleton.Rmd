---
title: Fairness Report
author:
  - name: First Author
output: html_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library("mlr3")
library("mlr3viz")
library("mlr3fairness")
library("ggplot2")
library("kableExtra")
library("iml")
```
<!-- This reads in `objects` provided to report_fairness: resample_result, task, ...-->

```{r, child = 'read_data.Rmd'}
```

## Audit Report: Summary

This document introduces on how to use `mlr3fairness` to create audit reports with different tasks throughout the fairness exploration process.

There are three main sections for this document. Which describe the details for the task, the model and the interpretability of the parameters.

Jump to section:

- [Task details](#task-details)
- [Model details](#model-details)
- [Interpretability](#Interpretability)

## Task details

In this fairness report, we investigate the fairness of the following task:

```{r}
task
```

### The General Task Documentation for the task:

Here we could get the basic details for the task.

```{r}
general_summary(task) %>%
  kbl() %>%
  kable_paper("hover", full_width = F)
```
### Exploratory Data Analysis: 

We could also report the number of missing values, type and the levels for each feature:

```{r}
df_summary = data.frame(task$col_info)[task$col_info$id != "..row_id",
                                       !(names(task$col_info) %in% c("id", "label"))]
data.frame("Count_of_Missing_Value" = task$missings()) %>%
  cbind(df_summary) %>%
  kbl() %>%
  kable_paper("hover", full_width = F)
```

We first look at the label distribution:

```{r}
autoplot(task) + facet_wrap(task$col_roles$pta)
```

## Model details

### Fairness Metrics

```{r}
fair_metrics = msrs(c("fairness.acc","fairness.eod","fairness.fnr",
  "fairness.fpr","fairness.npv","fairness.ppv","fairness.tnr",
  "fairness.tpr"))
```

```{r}
knitr::kable(resample_result$aggregate(fair_metrics))
```

```{r}
fairness_accuracy_tradeoff(resample_result)
```

```{r, eval = (resample_result$learner$predict_type == "prob")}
fairness_prediction_density(resample_result)
```

## Interpretability

# References
